benchmark.log cleaned
ramp: 200 rampTims: 3
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /better-sqlite3/read
Testing /better-sqlite3/write
Testing /better-sqlite3/rw
Testing /better-sqlite3/read/indexed
Testing /better-sqlite3/read/noindex
Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌──────────────────────────────┬─────────────┬──────────┬─────────┬──────┬─────────┬─────────┬─────────┬─────────┬─────────┬───────────┐
│ Case                         │ Concurrency │ Requests │ Success │ RPS  │ Min     │ 50%     │ 90%     │ 99%     │ Max     │ Test Time │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read         │ 200         │ 295      │ 89.15%  │ 25   │ 221ms   │ 5939ms  │ 7077ms  │ 10562ms │ 10648ms │ 10.73s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/write        │ 200         │ 12487    │ 100.00% │ 3058 │ 1ms     │ 47ms    │ 60ms    │ 1048ms  │ 3955ms  │ 4.08s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/rw           │ 200         │ 625      │ 100.00% │ 106  │ 11ms    │ 1671ms  │ 1729ms  │ 5847ms  │ 5901ms  │ 5.91s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/indexed │ 200         │ 864      │ 100.00% │ 168  │ 11ms    │ 1154ms  │ 1231ms  │ 1251ms  │ 2451ms  │ 5.14s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/noindex │ 200         │ 264      │ 75.76%  │ 16   │ 69ms    │ 8255ms  │ 11773ms │ 12559ms │ 12619ms │ 12.63s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read                │ 200         │ 200      │ 100.00% │ 11   │ 17670ms │ 17757ms │ 17767ms │ 17771ms │ 17771ms │ 17.79s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/write               │ 200         │ 4165     │ 100.00% │ 999  │ 39ms    │ 155ms   │ 217ms   │ 2080ms  │ 3798ms  │ 4.17s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/rw                  │ 200         │ 548      │ 100.00% │ 88   │ 819ms   │ 1745ms  │ 2877ms  │ 3972ms  │ 4013ms  │ 6.24s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/indexed        │ 200         │ 801      │ 100.00% │ 165  │ 14ms    │ 1123ms  │ 1588ms  │ 2276ms  │ 2348ms  │ 4.87s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/noindex        │ 200         │ 250      │ 94.40%  │ 17   │ 72ms    │ 11381ms │ 11389ms │ 11392ms │ 11393ms │ 13.66s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read               │ 200         │ 3367     │ 100.00% │ 796  │ 25ms    │ 241ms   │ 305ms   │ 367ms   │ 459ms   │ 4.23s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/write              │ 200         │ 20527    │ 100.00% │ 5094 │ 6ms     │ 38ms    │ 44ms    │ 62ms    │ 848ms   │ 4.03s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/rw                 │ 200         │ 632      │ 100.00% │ 120  │ 506ms   │ 1580ms  │ 1870ms  │ 2084ms  │ 2318ms  │ 5.27s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/indexed       │ 200         │ 12672    │ 100.00% │ 3127 │ 9ms     │ 62ms    │ 77ms    │ 99ms    │ 435ms   │ 4.05s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/noindex       │ 200         │ 824      │ 100.00% │ 152  │ 82ms    │ 1424ms  │ 1714ms  │ 1881ms  │ 2022ms  │ 5.41s     │
└──────────────────────────────┴─────────────┴──────────┴─────────┴──────┴─────────┴─────────┴─────────┴─────────┴─────────┴───────────┘
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /better-sqlite3/read
Testing /better-sqlite3/write
Testing /better-sqlite3/rw
Testing /better-sqlite3/read/indexed
Testing /better-sqlite3/read/noindex
Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌──────────────────────────────┬─────────────┬──────────┬─────────┬──────┬────────┬─────────┬─────────┬─────────┬─────────┬───────────┐
│ Case                         │ Concurrency │ Requests │ Success │ RPS  │ Min    │ 50%     │ 90%     │ 99%     │ Max     │ Test Time │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read         │ 400         │ 491      │ 86.76%  │ 23   │ 51ms   │ 7822ms  │ 16655ms │ 18591ms │ 18768ms │ 18.79s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/write        │ 400         │ 9972     │ 100.00% │ 2356 │ 3ms    │ 37ms    │ 55ms    │ 4094ms  │ 4118ms  │ 4.23s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/rw           │ 400         │ 797      │ 99.87%  │ 116  │ 12ms   │ 2876ms  │ 4018ms  │ 4036ms  │ 6857ms  │ 6.88s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/indexed │ 400         │ 995      │ 100.00% │ 149  │ 12ms   │ 1934ms  │ 6003ms  │ 6607ms  │ 6663ms  │ 6.68s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/noindex │ 400         │ 457      │ 87.53%  │ 15   │ 77ms   │ 15575ms │ 24704ms │ 26173ms │ 26310ms │ 26.32s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read                │ 400         │ 419      │ 100.00% │ 24   │ 51ms   │ 16632ms │ 16634ms │ 16662ms │ 17036ms │ 17.55s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/write               │ 400         │ 4367     │ 100.00% │ 1004 │ 40ms   │ 252ms   │ 373ms   │ 3875ms  │ 3895ms  │ 4.35s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/rw                  │ 400         │ 745      │ 100.00% │ 97   │ 786ms  │ 3778ms  │ 3965ms  │ 6752ms  │ 6844ms  │ 7.71s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/indexed        │ 400         │ 988      │ 100.00% │ 144  │ 22ms   │ 2686ms  │ 2886ms  │ 4119ms  │ 4186ms  │ 6.88s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/noindex        │ 400         │ 425      │ 96.47%  │ 15   │ 91ms   │ 25437ms │ 25454ms │ 27209ms │ 27212ms │ 27.22s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read               │ 400         │ 3251     │ 100.00% │ 723  │ 80ms   │ 531ms   │ 613ms   │ 691ms   │ 774ms   │ 4.50s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/write              │ 400         │ 20242    │ 100.00% │ 4977 │ 16ms   │ 77ms    │ 93ms    │ 113ms   │ 368ms   │ 4.07s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/rw                 │ 400         │ 798      │ 87.34%  │ 104  │ 1125ms │ 2972ms  │ 3432ms  │ 3834ms  │ 4383ms  │ 6.71s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/indexed       │ 400         │ 12146    │ 100.00% │ 2944 │ 13ms   │ 133ms   │ 153ms   │ 174ms   │ 517ms   │ 4.13s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/noindex       │ 400         │ 976      │ 73.26%  │ 116  │ 251ms  │ 2081ms  │ 2480ms  │ 2636ms  │ 2767ms  │ 6.17s     │
└──────────────────────────────┴─────────────┴──────────┴─────────┴──────┴────────┴─────────┴─────────┴─────────┴─────────┴───────────┘
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /better-sqlite3/read
Testing /better-sqlite3/write
Testing /better-sqlite3/rw
Testing /better-sqlite3/read/indexed
Testing /better-sqlite3/read/noindex
Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌──────────────────────────────┬─────────────┬──────────┬─────────┬──────┬────────┬─────────┬─────────┬─────────┬─────────┬───────────┐
│ Case                         │ Concurrency │ Requests │ Success │ RPS  │ Min    │ 50%     │ 90%     │ 99%     │ Max     │ Test Time │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read         │ 600         │ 714      │ 84.03%  │ 23   │ 58ms   │ 13910ms │ 22911ms │ 25837ms │ 26165ms │ 26.19s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/write        │ 600         │ 9921     │ 100.00% │ 2336 │ 1ms    │ 42ms    │ 66ms    │ 4164ms  │ 4195ms  │ 4.25s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/rw           │ 600         │ 1064     │ 93.70%  │ 99   │ 19ms   │ 4751ms  │ 6070ms  │ 6087ms  │ 6092ms  │ 10.08s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/indexed │ 600         │ 1135     │ 100.00% │ 138  │ 23ms   │ 1901ms  │ 7338ms  │ 8133ms  │ 8220ms  │ 8.25s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /better-sqlite3/read/noindex │ 600         │ 655      │ 91.60%  │ 14   │ 82ms   │ 22075ms │ 36977ms │ 41158ms │ 41590ms │ 41.61s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read                │ 600         │ 626      │ 99.36%  │ 23   │ 71ms   │ 26078ms │ 26091ms │ 26109ms │ 26156ms │ 27.14s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/write               │ 600         │ 4609     │ 100.00% │ 1035 │ 27ms   │ 336ms   │ 632ms   │ 3752ms  │ 3781ms  │ 4.45s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/rw                  │ 600         │ 932      │ 100.00% │ 91   │ 857ms  │ 3882ms  │ 7337ms  │ 8342ms  │ 8462ms  │ 10.21s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/indexed        │ 600         │ 1046     │ 100.00% │ 129  │ 44ms   │ 1801ms  │ 8085ms  │ 8100ms  │ 8108ms  │ 8.14s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/noindex        │ 600         │ 639      │ 100.00% │ 14   │ 87ms   │ 43191ms │ 43280ms │ 43288ms │ 43295ms │ 46.16s    │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read               │ 600         │ 4195     │ 100.00% │ 870  │ 1ms    │ 818ms   │ 897ms   │ 968ms   │ 1106ms  │ 4.82s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/write              │ 600         │ 21059    │ 100.00% │ 5115 │ 36ms   │ 110ms   │ 142ms   │ 170ms   │ 424ms   │ 4.12s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/rw                 │ 600         │ 1147     │ 57.54%  │ 79   │ 1948ms │ 3917ms  │ 4319ms  │ 4644ms  │ 5371ms  │ 8.34s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/indexed       │ 600         │ 11746    │ 100.00% │ 2798 │ 24ms   │ 212ms   │ 232ms   │ 256ms   │ 300ms   │ 4.20s     │
├──────────────────────────────┼─────────────┼──────────┼─────────┼──────┼────────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/noindex       │ 600         │ 1362     │ 50.07%  │ 110  │ 136ms  │ 2038ms  │ 2468ms  │ 2624ms  │ 2772ms  │ 6.19s     │
└──────────────────────────────┴─────────────┴──────────┴─────────┴──────┴────────┴─────────┴─────────┴─────────┴─────────┴───────────┘
--------------------------------
┌──────────────────────────────┬─────────────┬───────┬─────────┬──────┬───────┬───────┬───────┬───────┬───────┐
│ Name                         │ Concurrency │ Count │ Success │ RPS  │ Min   │ 50%   │ 90%   │ Max   │ Time  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read         │ 200         │ 295   │ 263     │ 25   │ 221   │ 5939  │ 7077  │ 10648 │ 10.73 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read         │ 400         │ 491   │ 426     │ 23   │ 51    │ 7822  │ 16655 │ 18768 │ 18.79 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read         │ 600         │ 714   │ 600     │ 23   │ 58    │ 13910 │ 22911 │ 26165 │ 26.19 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/write        │ 200         │ 12487 │ 12487   │ 3058 │ 1     │ 47    │ 60    │ 3955  │ 4.08  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/write        │ 400         │ 9972  │ 9972    │ 2356 │ 3     │ 37    │ 55    │ 4118  │ 4.23  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/write        │ 600         │ 9921  │ 9921    │ 2336 │ 1     │ 42    │ 66    │ 4195  │ 4.25  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/rw           │ 200         │ 625   │ 625     │ 106  │ 11    │ 1671  │ 1729  │ 5901  │ 5.91  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/rw           │ 400         │ 797   │ 796     │ 116  │ 12    │ 2876  │ 4018  │ 6857  │ 6.88  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/rw           │ 600         │ 1064  │ 997     │ 99   │ 19    │ 4751  │ 6070  │ 6092  │ 10.08 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/indexed │ 200         │ 864   │ 864     │ 168  │ 11    │ 1154  │ 1231  │ 2451  │ 5.14  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/indexed │ 400         │ 995   │ 995     │ 149  │ 12    │ 1934  │ 6003  │ 6663  │ 6.68  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/indexed │ 600         │ 1135  │ 1135    │ 138  │ 23    │ 1901  │ 7338  │ 8220  │ 8.25  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/noindex │ 200         │ 264   │ 200     │ 16   │ 69    │ 8255  │ 11773 │ 12619 │ 12.63 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/noindex │ 400         │ 457   │ 400     │ 15   │ 77    │ 15575 │ 24704 │ 26310 │ 26.32 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/noindex │ 600         │ 655   │ 600     │ 14   │ 82    │ 22075 │ 36977 │ 41590 │ 41.61 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read                │ 200         │ 200   │ 200     │ 11   │ 17670 │ 17757 │ 17767 │ 17771 │ 17.79 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read                │ 400         │ 419   │ 419     │ 24   │ 51    │ 16632 │ 16634 │ 17036 │ 17.55 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read                │ 600         │ 626   │ 622     │ 23   │ 71    │ 26078 │ 26091 │ 26156 │ 27.14 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/write               │ 200         │ 4165  │ 4165    │ 999  │ 39    │ 155   │ 217   │ 3798  │ 4.17  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/write               │ 400         │ 4367  │ 4367    │ 1004 │ 40    │ 252   │ 373   │ 3895  │ 4.35  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/write               │ 600         │ 4609  │ 4609    │ 1035 │ 27    │ 336   │ 632   │ 3781  │ 4.45  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/rw                  │ 200         │ 548   │ 548     │ 88   │ 819   │ 1745  │ 2877  │ 4013  │ 6.24  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/rw                  │ 400         │ 745   │ 745     │ 97   │ 786   │ 3778  │ 3965  │ 6844  │ 7.71  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/rw                  │ 600         │ 932   │ 932     │ 91   │ 857   │ 3882  │ 7337  │ 8462  │ 10.21 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/indexed        │ 200         │ 801   │ 801     │ 165  │ 14    │ 1123  │ 1588  │ 2348  │ 4.87  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/indexed        │ 400         │ 988   │ 988     │ 144  │ 22    │ 2686  │ 2886  │ 4186  │ 6.88  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/indexed        │ 600         │ 1046  │ 1046    │ 129  │ 44    │ 1801  │ 8085  │ 8108  │ 8.14  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/noindex        │ 200         │ 250   │ 236     │ 17   │ 72    │ 11381 │ 11389 │ 11393 │ 13.66 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/noindex        │ 400         │ 425   │ 410     │ 15   │ 91    │ 25437 │ 25454 │ 27212 │ 27.22 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/noindex        │ 600         │ 639   │ 639     │ 14   │ 87    │ 43191 │ 43280 │ 43295 │ 46.16 │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read               │ 200         │ 3367  │ 3367    │ 796  │ 25    │ 241   │ 305   │ 459   │ 4.23  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read               │ 400         │ 3251  │ 3251    │ 723  │ 80    │ 531   │ 613   │ 774   │ 4.50  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read               │ 600         │ 4195  │ 4195    │ 870  │ 1     │ 818   │ 897   │ 1106  │ 4.82  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/write              │ 200         │ 20527 │ 20527   │ 5094 │ 6     │ 38    │ 44    │ 848   │ 4.03  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/write              │ 400         │ 20242 │ 20242   │ 4977 │ 16    │ 77    │ 93    │ 368   │ 4.07  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/write              │ 600         │ 21059 │ 21059   │ 5115 │ 36    │ 110   │ 142   │ 424   │ 4.12  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/rw                 │ 200         │ 632   │ 632     │ 120  │ 506   │ 1580  │ 1870  │ 2318  │ 5.27  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/rw                 │ 400         │ 798   │ 697     │ 104  │ 1125  │ 2972  │ 3432  │ 4383  │ 6.71  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/rw                 │ 600         │ 1147  │ 660     │ 79   │ 1948  │ 3917  │ 4319  │ 5371  │ 8.34  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/indexed       │ 200         │ 12672 │ 12672   │ 3127 │ 9     │ 62    │ 77    │ 435   │ 4.05  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/indexed       │ 400         │ 12146 │ 12146   │ 2944 │ 13    │ 133   │ 153   │ 517   │ 4.13  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/indexed       │ 600         │ 11746 │ 11746   │ 2798 │ 24    │ 212   │ 232   │ 300   │ 4.20  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/noindex       │ 200         │ 824   │ 824     │ 152  │ 82    │ 1424  │ 1714  │ 2022  │ 5.41  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/noindex       │ 400         │ 976   │ 715     │ 116  │ 251   │ 2081  │ 2480  │ 2767  │ 6.17  │
├──────────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┼───────┤
│ /postgres/read/noindex       │ 600         │ 1362  │ 682     │ 110  │ 136   │ 2038  │ 2468  │ 2772  │ 6.19  │
└──────────────────────────────┴─────────────┴───────┴─────────┴──────┴───────┴───────┴───────┴───────┴───────┘
--------------------------------
┌──────────────────────────────┬──────────┬──────────┬──────────┬───────┬─────────┬──────┬───────┬───────┬───────┬───────┐
│ Name                         │ 200C RPS │ 400C RPS │ 600C RPS │ Count │ Success │ Min  │ 50%   │ 90%   │ Max   │ Time  │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read         │ 25       │ 23       │ 23       │ 500   │ 86%     │ 110  │ 9224  │ 15548 │ 18527 │ 55.71 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/write        │ 3058     │ 2356     │ 2336     │ 10793 │ 100%    │ 2    │ 42    │ 60    │ 4089  │ 12.56 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/rw           │ 106      │ 116      │ 99       │ 829   │ 97%     │ 14   │ 3099  │ 3939  │ 6283  │ 22.87 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/indexed │ 168      │ 149      │ 138      │ 998   │ 100%    │ 15   │ 1663  │ 4857  │ 5778  │ 20.07 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /better-sqlite3/read/noindex │ 16       │ 15       │ 14       │ 459   │ 87%     │ 76   │ 15302 │ 24485 │ 26840 │ 80.56 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read                │ 11       │ 24       │ 23       │ 415   │ 100%    │ 5931 │ 20156 │ 20164 │ 20321 │ 62.48 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /sqlite3/write               │ 999      │ 1004     │ 1035     │ 4380  │ 100%    │ 35   │ 248   │ 407   │ 3825  │ 12.97 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /sqlite3/rw                  │ 88       │ 97       │ 91       │ 742   │ 100%    │ 821  │ 3135  │ 4726  │ 6440  │ 24.16 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/indexed        │ 165      │ 144      │ 129      │ 945   │ 100%    │ 27   │ 1870  │ 4186  │ 4881  │ 19.89 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /sqlite3/read/noindex        │ 17       │ 15       │ 14       │ 438   │ 98%     │ 83   │ 26670 │ 26708 │ 27300 │ 87.04 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /postgres/read               │ 796      │ 723      │ 870      │ 3604  │ 100%    │ 35   │ 530   │ 605   │ 780   │ 13.55 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /postgres/write              │ 5094     │ 4977     │ 5115     │ 20609 │ 100%    │ 19   │ 75    │ 93    │ 547   │ 12.22 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /postgres/rw                 │ 120      │ 104      │ 79       │ 859   │ 77%     │ 1193 │ 2823  │ 3207  │ 4024  │ 20.32 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /postgres/read/indexed       │ 3127     │ 2944     │ 2798     │ 12188 │ 100%    │ 15   │ 136   │ 154   │ 417   │ 12.38 │
├──────────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼──────┼───────┼───────┼───────┼───────┤
│ /postgres/read/noindex       │ 152      │ 116      │ 110      │ 1054  │ 70%     │ 156  │ 1848  │ 2221  │ 2520  │ 17.77 │
└──────────────────────────────┴──────────┴──────────┴──────────┴───────┴─────────┴──────┴───────┴───────┴───────┴───────┘
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/1-RPS-vs-Concurrency.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/2-Degradation-Trend.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/3-Top10-Max-RPS.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/4-Top10-Lowest-t90.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/5-RPS-vs-t90.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/6-Performance-Radar.png
Server Version: unknown
Platform: linux
CPU Cores: 8
Memory (GB): 16
Total Time: 475.495s
🧠 Ask OpenAI for analysis...

✅ Analysis report:

## 接口性能概览

本报告分析了 Node.js 服务在不同并发下，使用 SQLite3, better-sqlite3 和 PostgreSQL 数据库的多个接口的性能表现。压测并发级别为 200, 400 和 600。  所有接口均提供读(read)、写(write)、读写读(rw)、索引读(read/indexed)和无索引读(read/noindex)操作。

| 数据库 | 接口类型 | 并发 200 RPS | 并发 200 P99 (ms) | 并发 400 RPS | 并发 400 P99 (ms) | 并发 600 RPS | 并发 600 P99 (ms) |
|---|---|---|---|---|---|---|---|
| better-sqlite3 | read | 25 | 10562 | 23 | 18591 | 23 | 25837 |
| better-sqlite3 | write | 3058 | 1048 | 2356 | 4094 | 2336 | 4164 |
| better-sqlite3 | rw | 106 | 5847 | 116 | 4036 | 99 | 6087 |
| better-sqlite3 | read/indexed | 168 | 1251 | 149 | 6607 | 138 | 8133 |
| better-sqlite3 | read/noindex | 16 | 12559 | 15 | 26173 | 14 | 41158 |
| sqlite3 | read | 11 | 17771 | 24 | 16662 | 23 | 26109 |
| sqlite3 | write | 999 | 2080 | 1004 | 3875 | 1035 | 3752 |
| sqlite3 | rw | 88 | 3972 | 97 | 6752 | 91 | 8342 |
| sqlite3 | read/indexed | 165 | 2276 | 144 | 4119 | 129 | 8100 |
| sqlite3 | read/noindex | 17 | 11392 | 15 | 27209 | 14 | 43288 |
| PostgreSQL | read | 796 | 367 | 723 | 691 | 870 | 968 |
| PostgreSQL | write | 5094 | 62 | 4977 | 113 | 5115 | 170 |
| PostgreSQL | rw | 120 | 2084 | 104 | 3834 | 79 | 4644 |
| PostgreSQL | read/indexed | 3127 | 99 | 2944 | 174 | 2798 | 256 |
| PostgreSQL | read/noindex | 152 | 1881 | 116 | 2636 | 110 | 2624 |


## 问题诊断

1. **better-sqlite3 和 sqlite3 的读操作性能极差:**  `read` 和 `read/noindex` 接口在所有并发级别下都表现出极低的 RPS 和极高的 P99 延迟。这强烈暗示着 SQLite 数据库本身的性能瓶颈，尤其是在高并发读请求下，单线程模型的限制非常明显。无索引读操作的延迟更是远超索引读操作，说明索引使用效率不高，或者数据量过大导致索引查找效率降低。  P99 远高于 P90 也说明存在长尾延迟，可能与数据库锁竞争或磁盘 I/O 等待有关。

2. **better-sqlite3 和 sqlite3 的索引读操作性能中等:** `read/indexed` 接口的性能比无索引读操作好很多，但随着并发增加，P99 延迟也显著上升，说明索引虽然有效，但在高并发下仍然存在瓶颈。这可能是由于 SQLite 的单线程特性导致的锁竞争和资源争用。

3. **PostgreSQL 的整体性能最佳:** PostgreSQL 在所有接口中都展现出最高的 RPS 和最低的延迟，这得益于其多线程架构和成熟的数据库优化机制。即使在高并发下，其性能也保持相对稳定，P99 延迟增长幅度较小。

4. **所有数据库的写操作性能相对较好:**  `write` 接口在所有数据库中都表现出较高的 RPS 和较低的延迟，这可能是因为写操作通常比读操作更简单，且数据库的写操作优化相对较好。但是，better-sqlite3 的写操作在高并发下P99延迟也开始上升，这预示着其性能瓶颈的临近。

5. **读写读操作性能瓶颈:** `rw` 接口的性能介于读写操作之间，其性能瓶颈可能与读操作类似，受到数据库性能的限制。

6. **非线性缩放:**  所有使用 SQLite 的接口在并发增加时，RPS 的增长并不线性，甚至出现下降趋势，这表明系统在较低的并发下就已达到性能瓶颈。PostgreSQL 的性能缩放相对线性，但高并发下也存在一定程度的性能下降。


## 优化建议

1. **数据库选择:**  对于高并发场景，强烈建议 **放弃 SQLite**，因为它不适合处理高并发请求。SQLite 的单线程模型是其性能瓶颈的根本原因。应该将所有数据库操作迁移到 PostgreSQL。

2. **连接池:**  为 PostgreSQL 连接池设置合理的连接数，避免连接耗尽。可以使用 Node.js 的连接池库，如 `pg-pool`。

3. **数据库优化:**  对 PostgreSQL 数据库进行优化，例如：
    *  检查数据库索引是否有效，并根据实际情况调整索引策略。
    *  优化 SQL 查询语句，减少数据库查询时间。
    *  使用数据库缓存（如 Redis）缓存频繁访问的数据。
    *  使用数据库连接池，减少连接建立和关闭的开销。
    *  考虑使用数据库读写分离，将读操作和写操作分离到不同的数据库服务器上。

4. **缓存:**  引入缓存机制（例如 Redis）缓存频繁访问的数据，减少数据库查询次数。对于读操作，缓存可以显著提升性能。

5. **异步处理:**  使用异步编程模型，例如使用 `async/await` 或 Promise，避免阻塞主线程。对于数据库操作，可以使用异步操作库，例如 `pg-promise`。

6. **负载均衡:**  如果需要处理更高的并发量，可以考虑使用负载均衡器，将请求分发到多个 Node.js 服务器上。

7. **代码优化:**  对代码进行性能分析，找出性能瓶颈，并进行优化。可以使用 Node.js 的性能分析工具，例如 `node --prof`。

8. **监控和报警:**  设置监控系统，监控系统的性能指标，例如 RPS、延迟、错误率等。当性能指标超过阈值时，及时报警。

9. **分析工具:**  使用 APM 工具（如 New Relic, Datadog）监控应用性能，并结合数据库 Profiler (例如 pgAdmin 的查询分析工具) 分析数据库查询的性能瓶颈。  使用 tracing 工具 (例如 Jaeger, Zipkin) 追踪请求的执行路径，定位性能瓶颈。


## 优先级排序

1. **迁移到 PostgreSQL:**  这是最重要的优化措施，可以显著提升系统的整体性能。
2. **引入缓存:**  缓存可以有效减少数据库负载，降低延迟。
3. **数据库优化:**  优化数据库查询语句和索引策略，提高数据库查询效率。
4. **异步处理:**  异步处理可以提高系统的并发处理能力。
5. **连接池优化:**  确保 PostgreSQL 连接池配置合理。
6. **代码优化:**  对代码进行性能分析和优化。
7. **负载均衡 (如果需要):**  当单机性能无法满足需求时，再考虑负载均衡。


## 分析总结

该 Node.js 服务的性能瓶颈主要在于使用了不适合高并发场景的 SQLite 数据库。  better-sqlite3 虽然在 Promise 模式下提供了更好的异步能力，但仍然无法克服 SQLite 单线程的根本限制。PostgreSQL 的性能表现远优于 SQLite，证明了选择合适的数据库对于高并发系统的重要性。  通过迁移到 PostgreSQL，结合缓存、异步处理和数据库优化等措施，可以显著提升系统的性能和稳定性。  建议使用 APM 和数据库 Profiler 等工具进一步精细化调优。

--------------------------------
✅ Benchmark finished, all results are saved in benchmark-output folder
--------------------------------
