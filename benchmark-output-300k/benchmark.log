benchmark.log cleaned
ramp: 200 rampTims: 3
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /sqlite3/count(*)
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex
Testing /postgres/count(*)

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌────────────────────────┬─────────────┬──────────┬─────────┬──────┬─────────┬──────────┬──────────┬──────────┬──────────┬───────────┐
│ Case                   │ Concurrency │ Requests │ Success │ RPS  │ Min     │ 50%      │ 90%      │ 99%      │ Max      │ Test Time │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read          │ 200         │ 200      │ 100.00% │ 2    │ 85662ms │ 101484ms │ 101498ms │ 101537ms │ 101538ms │ 101.55s   │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/write         │ 200         │ 5042     │ 100.00% │ 976  │ 76ms    │ 189ms    │ 228ms    │ 1142ms   │ 3361ms   │ 5.17s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/rw            │ 200         │ 4426     │ 100.00% │ 870  │ 97ms    │ 226ms    │ 253ms    │ 288ms    │ 459ms    │ 5.09s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read/indexed  │ 200         │ 240      │ 100.00% │ 39   │ 37ms    │ 5122ms   │ 5138ms   │ 5146ms   │ 5173ms   │ 6.18s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read/noindex  │ 200         │ 212      │ 99.53%  │ 4    │ 255ms   │ 45741ms  │ 46065ms  │ 46080ms  │ 46083ms  │ 48.57s    │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/count(*)      │ 200         │ 1509     │ 100.00% │ 264  │ 31ms    │ 630ms    │ 709ms    │ 4975ms   │ 4982ms   │ 5.71s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read         │ 200         │ 1221     │ 100.00% │ 211  │ 487ms   │ 908ms    │ 1018ms   │ 1222ms   │ 1411ms   │ 5.78s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/write        │ 200         │ 24137    │ 100.00% │ 4812 │ 7ms     │ 37ms     │ 43ms     │ 252ms    │ 1227ms   │ 5.02s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/rw           │ 200         │ 23886    │ 100.00% │ 4738 │ 1ms     │ 47ms     │ 54ms     │ 383ms    │ 721ms    │ 5.04s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read/indexed │ 200         │ 5903     │ 100.00% │ 1145 │ 110ms   │ 168ms    │ 210ms    │ 259ms    │ 351ms    │ 5.16s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read/noindex │ 200         │ 550      │ 54.00%  │ 41   │ 595ms   │ 2010ms   │ 2949ms   │ 3334ms   │ 3446ms   │ 7.20s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼─────────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/count(*)     │ 200         │ 1016     │ 100.00% │ 168  │ 209ms   │ 1173ms   │ 1283ms   │ 1371ms   │ 1447ms   │ 6.04s     │
└────────────────────────┴─────────────┴──────────┴─────────┴──────┴─────────┴──────────┴──────────┴──────────┴──────────┴───────────┘
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /sqlite3/count(*)
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex
Testing /postgres/count(*)

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌────────────────────────┬─────────────┬──────────┬─────────┬──────┬───────┬─────────┬─────────┬─────────┬─────────┬───────────┐
│ Case                   │ Concurrency │ Requests │ Success │ RPS  │ Min   │ 50%     │ 90%     │ 99%     │ Max     │ Test Time │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read          │ 400         │ 426      │ 96.48%  │ 6    │ 177ms │ 62114ms │ 62123ms │ 62124ms │ 62143ms │ 63.95s    │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/write         │ 400         │ 5265     │ 100.00% │ 979  │ 62ms  │ 199ms   │ 443ms   │ 4815ms  │ 4848ms  │ 5.38s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/rw            │ 400         │ 5878     │ 100.00% │ 1110 │ 1ms   │ 330ms   │ 372ms   │ 4612ms  │ 4952ms  │ 5.29s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/indexed  │ 400         │ 423      │ 99.76%  │ 58   │ 27ms  │ 6799ms  │ 6850ms  │ 6856ms  │ 6860ms  │ 7.23s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/read/noindex  │ 400         │ 411      │ 98.05%  │ 5    │ 205ms │ 77454ms │ 77463ms │ 77473ms │ 77857ms │ 77.87s    │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /sqlite3/count(*)      │ 400         │ 2429     │ 100.00% │ 431  │ 17ms  │ 754ms   │ 973ms   │ 4946ms  │ 5133ms  │ 5.64s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read         │ 400         │ 1684     │ 100.00% │ 249  │ 1ms   │ 1846ms  │ 1969ms  │ 2051ms  │ 2107ms  │ 6.76s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/write        │ 400         │ 25087    │ 100.00% │ 4759 │ 24ms  │ 75ms    │ 82ms    │ 569ms   │ 843ms   │ 5.27s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/rw           │ 400         │ 20333    │ 100.00% │ 4002 │ 13ms  │ 98ms    │ 108ms   │ 132ms   │ 163ms   │ 5.08s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/indexed │ 400         │ 5134     │ 100.00% │ 961  │ 64ms  │ 369ms   │ 458ms   │ 946ms   │ 1030ms  │ 5.34s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/read/noindex │ 400         │ 1152     │ 26.30%  │ 41   │ 522ms │ 2025ms  │ 2855ms  │ 3308ms  │ 3515ms  │ 7.46s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼─────────┼─────────┼─────────┼─────────┼───────────┤
│ /postgres/count(*)     │ 400         │ 1495     │ 79.93%  │ 167  │ 219ms │ 2011ms  │ 2384ms  │ 2517ms  │ 2613ms  │ 7.16s     │
└────────────────────────┴─────────────┴──────────┴─────────┴──────┴───────┴─────────┴─────────┴─────────┴─────────┴───────────┘
Benchmarking http://localhost:3333


--- Testing endpoints in mode concurrent ---

Testing /sqlite3/read
Testing /sqlite3/write
Testing /sqlite3/rw
Testing /sqlite3/read/indexed
Testing /sqlite3/read/noindex
Testing /sqlite3/count(*)
Testing /postgres/read
Testing /postgres/write
Testing /postgres/rw
Testing /postgres/read/indexed
Testing /postgres/read/noindex
Testing /postgres/count(*)

-----------------

Mode: concurrent - Concurrent Mode: Keeps concurrency level steady.
┌────────────────────────┬─────────────┬──────────┬─────────┬──────┬───────┬──────────┬──────────┬──────────┬──────────┬───────────┐
│ Case                   │ Concurrency │ Requests │ Success │ RPS  │ Min   │ 50%      │ 90%      │ 99%      │ Max      │ Test Time │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read          │ 600         │ 625      │ 97.76%  │ 8    │ 140ms │ 70633ms  │ 70682ms  │ 70689ms  │ 70705ms  │ 72.07s    │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/write         │ 600         │ 5639     │ 100.00% │ 1019 │ 17ms  │ 456ms    │ 549ms    │ 4915ms   │ 5312ms   │ 5.54s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/rw            │ 600         │ 4762     │ 100.00% │ 821  │ 357ms │ 707ms    │ 914ms    │ 954ms    │ 2197ms   │ 5.80s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read/indexed  │ 600         │ 641      │ 99.22%  │ 27   │ 55ms  │ 22380ms  │ 22457ms  │ 22463ms  │ 22472ms  │ 23.88s    │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/read/noindex  │ 600         │ 601      │ 100.00% │ 3    │ 335ms │ 190747ms │ 190759ms │ 190772ms │ 190774ms │ 190.78s   │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /sqlite3/count(*)      │ 600         │ 1382     │ 100.00% │ 177  │ 40ms  │ 2838ms   │ 3360ms   │ 6975ms   │ 7217ms   │ 7.80s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read         │ 600         │ 1900     │ 74.00%  │ 198  │ 270ms │ 2077ms   │ 2249ms   │ 2339ms   │ 2421ms   │ 7.09s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/write        │ 600         │ 21291    │ 100.00% │ 4172 │ 38ms  │ 128ms    │ 140ms    │ 645ms    │ 662ms    │ 5.10s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/rw           │ 600         │ 22317    │ 100.00% │ 4362 │ 1ms   │ 156ms    │ 177ms    │ 703ms    │ 714ms    │ 5.12s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read/indexed │ 600         │ 5369     │ 100.00% │ 970  │ 47ms  │ 563ms    │ 673ms    │ 1039ms   │ 1132ms   │ 5.54s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/read/noindex │ 600         │ 1750     │ 16.00%  │ 37   │ 515ms │ 2020ms   │ 2740ms   │ 3354ms   │ 3764ms   │ 7.49s     │
├────────────────────────┼─────────────┼──────────┼─────────┼──────┼───────┼──────────┼──────────┼──────────┼──────────┼───────────┤
│ /postgres/count(*)     │ 600         │ 1819     │ 46.40%  │ 118  │ 291ms │ 2064ms   │ 2423ms   │ 2600ms   │ 2713ms   │ 7.13s     │
└────────────────────────┴─────────────┴──────────┴─────────┴──────┴───────┴──────────┴──────────┴──────────┴──────────┴───────────┘
--------------------------------
┌────────────────────────┬─────────────┬───────┬─────────┬──────┬───────┬────────┬────────┬────────┬────────┐
│ Name                   │ Concurrency │ Count │ Success │ RPS  │ Min   │ 50%    │ 90%    │ Max    │ Time   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read          │ 200         │ 200   │ 200     │ 2    │ 85662 │ 101484 │ 101498 │ 101538 │ 101.55 │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read          │ 400         │ 426   │ 411     │ 6    │ 177   │ 62114  │ 62123  │ 62143  │ 63.95  │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read          │ 600         │ 625   │ 611     │ 8    │ 140   │ 70633  │ 70682  │ 70705  │ 72.07  │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/write         │ 200         │ 5042  │ 5042    │ 976  │ 76    │ 189    │ 228    │ 3361   │ 5.17   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/write         │ 400         │ 5265  │ 5265    │ 979  │ 62    │ 199    │ 443    │ 4848   │ 5.38   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/write         │ 600         │ 5639  │ 5639    │ 1019 │ 17    │ 456    │ 549    │ 5312   │ 5.54   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/rw            │ 200         │ 4426  │ 4426    │ 870  │ 97    │ 226    │ 253    │ 459    │ 5.09   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/rw            │ 400         │ 5878  │ 5878    │ 1110 │ 1     │ 330    │ 372    │ 4952   │ 5.29   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/rw            │ 600         │ 4762  │ 4762    │ 821  │ 357   │ 707    │ 914    │ 2197   │ 5.80   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/indexed  │ 200         │ 240   │ 240     │ 39   │ 37    │ 5122   │ 5138   │ 5173   │ 6.18   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/indexed  │ 400         │ 423   │ 422     │ 58   │ 27    │ 6799   │ 6850   │ 6860   │ 7.23   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/indexed  │ 600         │ 641   │ 636     │ 27   │ 55    │ 22380  │ 22457  │ 22472  │ 23.88  │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/noindex  │ 200         │ 212   │ 211     │ 4    │ 255   │ 45741  │ 46065  │ 46083  │ 48.57  │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/noindex  │ 400         │ 411   │ 403     │ 5    │ 205   │ 77454  │ 77463  │ 77857  │ 77.87  │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/noindex  │ 600         │ 601   │ 601     │ 3    │ 335   │ 190747 │ 190759 │ 190774 │ 190.78 │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/count(*)      │ 200         │ 1509  │ 1509    │ 264  │ 31    │ 630    │ 709    │ 4982   │ 5.71   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/count(*)      │ 400         │ 2429  │ 2429    │ 431  │ 17    │ 754    │ 973    │ 5133   │ 5.64   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/count(*)      │ 600         │ 1382  │ 1382    │ 177  │ 40    │ 2838   │ 3360   │ 7217   │ 7.80   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read         │ 200         │ 1221  │ 1221    │ 211  │ 487   │ 908    │ 1018   │ 1411   │ 5.78   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read         │ 400         │ 1684  │ 1684    │ 249  │ 1     │ 1846   │ 1969   │ 2107   │ 6.76   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read         │ 600         │ 1900  │ 1406    │ 198  │ 270   │ 2077   │ 2249   │ 2421   │ 7.09   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/write        │ 200         │ 24137 │ 24137   │ 4812 │ 7     │ 37     │ 43     │ 1227   │ 5.02   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/write        │ 400         │ 25087 │ 25087   │ 4759 │ 24    │ 75     │ 82     │ 843    │ 5.27   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/write        │ 600         │ 21291 │ 21291   │ 4172 │ 38    │ 128    │ 140    │ 662    │ 5.10   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/rw           │ 200         │ 23886 │ 23886   │ 4738 │ 1     │ 47     │ 54     │ 721    │ 5.04   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/rw           │ 400         │ 20333 │ 20333   │ 4002 │ 13    │ 98     │ 108    │ 163    │ 5.08   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/rw           │ 600         │ 22317 │ 22317   │ 4362 │ 1     │ 156    │ 177    │ 714    │ 5.12   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/indexed │ 200         │ 5903  │ 5903    │ 1145 │ 110   │ 168    │ 210    │ 351    │ 5.16   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/indexed │ 400         │ 5134  │ 5134    │ 961  │ 64    │ 369    │ 458    │ 1030   │ 5.34   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/indexed │ 600         │ 5369  │ 5369    │ 970  │ 47    │ 563    │ 673    │ 1132   │ 5.54   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/noindex │ 200         │ 550   │ 297     │ 41   │ 595   │ 2010   │ 2949   │ 3446   │ 7.20   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/noindex │ 400         │ 1152  │ 303     │ 41   │ 522   │ 2025   │ 2855   │ 3515   │ 7.46   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/noindex │ 600         │ 1750  │ 280     │ 37   │ 515   │ 2020   │ 2740   │ 3764   │ 7.49   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/count(*)     │ 200         │ 1016  │ 1016    │ 168  │ 209   │ 1173   │ 1283   │ 1447   │ 6.04   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/count(*)     │ 400         │ 1495  │ 1195    │ 167  │ 219   │ 2011   │ 2384   │ 2613   │ 7.16   │
├────────────────────────┼─────────────┼───────┼─────────┼──────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/count(*)     │ 600         │ 1819  │ 844     │ 118  │ 291   │ 2064   │ 2423   │ 2713   │ 7.13   │
└────────────────────────┴─────────────┴───────┴─────────┴──────┴───────┴────────┴────────┴────────┴────────┘
--------------------------------
┌────────────────────────┬──────────┬──────────┬──────────┬───────┬─────────┬───────┬────────┬────────┬────────┬────────┐
│ Name                   │ 200C RPS │ 400C RPS │ 600C RPS │ Count │ Success │ Min   │ 50%    │ 90%    │ Max    │ Time   │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read          │ 2        │ 6        │ 8        │ 417   │ 98%     │ 28660 │ 78077  │ 78101  │ 78129  │ 237.57 │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/write         │ 976      │ 979      │ 1019     │ 5315  │ 100%    │ 52    │ 281    │ 407    │ 4507   │ 16.09  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/rw            │ 870      │ 1110     │ 821      │ 5022  │ 100%    │ 152   │ 421    │ 513    │ 2536   │ 16.18  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/indexed  │ 39       │ 58       │ 27       │ 435   │ 100%    │ 40    │ 11434  │ 11482  │ 11502  │ 37.29  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/read/noindex  │ 4        │ 5        │ 3        │ 408   │ 99%     │ 265   │ 104647 │ 104762 │ 104905 │ 317.22 │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /sqlite3/count(*)      │ 264      │ 431      │ 177      │ 1773  │ 100%    │ 29    │ 1407   │ 1681   │ 5777   │ 19.15  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read         │ 211      │ 249      │ 198      │ 1602  │ 90%     │ 253   │ 1610   │ 1745   │ 1980   │ 19.63  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/write        │ 4812     │ 4759     │ 4172     │ 23505 │ 100%    │ 23    │ 80     │ 88     │ 911    │ 15.39  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/rw           │ 4738     │ 4002     │ 4362     │ 22179 │ 100%    │ 5     │ 100    │ 113    │ 533    │ 15.24  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/indexed │ 1145     │ 961      │ 970      │ 5469  │ 100%    │ 74    │ 367    │ 447    │ 838    │ 16.04  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/read/noindex │ 41       │ 41       │ 37       │ 1151  │ 25%     │ 544   │ 2018   │ 2848   │ 3575   │ 22.15  │
├────────────────────────┼──────────┼──────────┼──────────┼───────┼─────────┼───────┼────────┼────────┼────────┼────────┤
│ /postgres/count(*)     │ 168      │ 167      │ 118      │ 1443  │ 71%     │ 240   │ 1749   │ 2030   │ 2258   │ 20.33  │
└────────────────────────┴──────────┴──────────┴──────────┴───────┴─────────┴───────┴────────┴────────┴────────┴────────┘
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/1-RPS-vs-Concurrency.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/2-Degradation-Trend.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/3-Top10-Max-RPS.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/4-Top10-Lowest-t90.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/5-RPS-vs-t90.png
✅ Saved: /home/pillar/source/sql-vs-pg/benchmark-output/6-Performance-Radar.png
Server Version: unknown
Platform: linux
CPU Cores: 8
Memory (GB): 16
Total Time: 753.119s
🧠 Ask OpenAI for analysis...

✅ Analysis report:

## 接口性能概览

本报告分析了 Node.js 服务在不同并发数下，使用 SQLite 和 PostgreSQL 数据库的多个接口的性能表现。压测结果显示，PostgreSQL 数据库在吞吐率和延迟方面均显著优于 SQLite 数据库。  SQLite 数据库在高并发下，尤其是非索引查询接口，性能急剧下降。

| 接口名称             | 数据库 | 并发数 | RPS       | P50(ms)   | P90(ms)   | P99(ms)   | Max(ms)   | 瓶颈推测                               |
|----------------------|---------|---------|-----------|-----------|-----------|-----------|-----------|-------------------------------------------|
| `/sqlite3/read`       | sqlite3 | 200     | 2         | 101484    | 101498    | 101537    | 101538    | 数据库IO，数据量大，无索引             |
| `/sqlite3/write`      | sqlite3 | 200     | 976      | 189       | 228       | 1142      | 3361      | 数据库IO，写入操作本身开销较大           |
| `/sqlite3/rw`        | sqlite3 | 200     | 870       | 226       | 253       | 288       | 459       | 数据库IO，读写混合操作，潜在锁竞争       |
| `/sqlite3/read/indexed` | sqlite3 | 200     | 39        | 5122      | 5138      | 5146      | 5173      | 数据库IO，索引扫描效率受限             |
| `/sqlite3/read/noindex`| sqlite3 | 200     | 4         | 45741     | 46065     | 46080     | 46083    | 数据库IO，全表扫描，数据量巨大           |
| `/sqlite3/count(*)`   | sqlite3 | 200     | 264       | 630       | 709       | 4975      | 4982      | 数据库IO，聚合操作开销较大               |
| `/postgres/read`      | postgres | 200     | 211       | 908       | 1018      | 1222      | 1411      | 数据库IO，但远优于SQLite                 |
| `/postgres/write`     | postgres | 200     | 4812      | 37        | 43        | 252       | 1227      | 数据库IO，写入效率高                     |
| `/postgres/rw`       | postgres | 200     | 4738      | 47        | 54        | 383       | 721       | 数据库IO，读写混合效率高                 |
| `/postgres/read/indexed`| postgres | 200     | 1145      | 168       | 210       | 259       | 351       | 数据库IO，索引扫描效率高                 |
| `/postgres/read/noindex`| postgres | 200     | 41        | 2010      | 2949      | 3334      | 3446      | 数据库IO，全表扫描，但远优于SQLite       |
| `/postgres/count(*)`  | postgres | 200     | 168       | 1173      | 1283      | 1371      | 1447      | 数据库IO，聚合操作效率高                 |


(以上表格仅列出部分并发数为200的结果，其他并发数结果类似，下文分析会涵盖所有并发数)


## 问题诊断

1. **SQLite 性能瓶颈:** SQLite 在高并发下表现极差，尤其是非索引读取(`/sqlite3/read`, `/sqlite3/read/noindex`)接口的 RPS 非常低，延迟极高。这主要是因为 SQLite 是单进程数据库，无法充分利用多核 CPU 资源，在高并发下容易出现锁竞争和 IO 瓶颈。  `better-sqlite3`虽然使用了Promise模式，但并没有从根本上解决SQLite的单进程限制。  即使是索引读取，性能也远低于 PostgreSQL。  `count(*)`操作在SQLite中也表现不佳，这可能是由于SQLite的聚合操作效率较低。

2. **PostgreSQL 性能表现:** PostgreSQL 在所有测试接口中都表现出良好的性能，RPS 高，延迟低，即使是非索引读取，性能也远超 SQLite。这得益于 PostgreSQL 的多进程架构和更优的查询优化器。

3. **非线性缩放:**  所有使用 SQLite 的接口在并发数增加时，RPS 的增长都远低于线性，甚至出现停滞。这表明系统已达到 SQLite 的性能瓶颈，单进程架构限制了其并发处理能力。PostgreSQL 的接口则表现出更接近线性的缩放，说明其架构更适合高并发场景。

4. **延迟抖动:**  SQLite 的一些接口，特别是那些 RPS 较低的接口，P99 远高于 P90，表明存在严重的延迟抖动，这可能是由于数据库锁竞争、IO等待时间长短不一导致的。PostgreSQL 的延迟抖动相对较小。


## 优化建议

1. **数据库迁移:**  强烈建议将 SQLite 替换为 PostgreSQL。PostgreSQL 的多进程架构和更优的性能使其更适合高并发应用。

2. **数据库连接池:**  对于 PostgreSQL，可以考虑使用连接池来管理数据库连接，避免频繁创建和销毁连接的开销。

3. **索引优化:**  虽然部分接口使用了索引，但性能仍然有提升空间。需要进一步分析查询语句和数据分布，优化索引策略，例如考虑复合索引。

4. **缓存机制:**  引入缓存机制（例如 Redis）可以显著减少数据库访问次数，降低数据库负载。对于读取操作，可以缓存查询结果。

5. **读写分离:**  对于读写混合操作(`/sqlite3/rw`, `/postgres/rw`)，可以考虑读写分离，将读操作和写操作分别路由到不同的数据库实例，以提高性能和并发能力。

6. **异步处理:**  对于一些耗时较长的操作，例如数据库查询，可以采用异步处理的方式，避免阻塞主线程，提高系统响应速度。  Node.js 的异步特性可以很好地支持这一点。

7. **限流:**  在高并发场景下，可以考虑引入限流机制，防止系统过载。

8. **代码优化:**  对数据库操作进行优化，例如使用更有效的 SQL 语句，减少不必要的数据库访问。

9. **监控和告警:**  使用 APM 工具（例如 New Relic, Datadog）监控系统性能，及时发现并解决潜在问题。  数据库 Profiler 可以帮助分析数据库查询的性能瓶颈。


## 优先级排序

1. **数据库迁移 (PostgreSQL):**  这是最重要的优化措施，可以从根本上解决 SQLite 的性能瓶颈。
2. **缓存机制:**  引入缓存可以显著提高读取操作的性能。
3. **读写分离:**  对于读写混合操作，读写分离可以进一步提升性能。
4. **索引优化:**  优化索引策略可以提高数据库查询效率。
5. **异步处理:**  异步处理可以提高系统响应速度。
6. **代码优化:**  优化数据库操作可以减少数据库负载。
7. **限流:**  限流可以防止系统过载。
8. **数据库连接池:**  优化数据库连接管理。


## 分析总结

本次压测结果清晰地表明了 SQLite 数据库在高并发场景下的性能瓶颈，其单进程架构限制了其并发处理能力。PostgreSQL 数据库则表现出良好的性能和可扩展性。  建议优先进行数据库迁移，并结合缓存、异步处理等技术，构建一个高性能、高可扩展性的 Node.js 服务。  使用 APM 和数据库 Profiler 等工具可以帮助更精细地定位和解决性能问题。  需要注意的是，/postgres/read/noindex 接口在高并发下也存在性能下降，虽然比SQLite好很多，但仍需关注。  这可能与PostgreSQL的查询规划器在处理无索引查询时的效率有关，进一步优化SQL语句或添加合适的索引可以改善。

--------------------------------
✅ Benchmark finished, all results are saved in benchmark-output folder
--------------------------------
